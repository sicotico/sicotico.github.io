---
layout: single
title:  "API Rest"
date:   2023-11-26 10:57:08 +0200
categories: 
---

__Solicitar token__

```bash
~$ curl -X POST -d 'grant_type=client_credentials&client_id=d5f85e45-d497-48d1-aedd-22d524d00c71&client_secret=bHH8Q~KutTY5SbXF1jMaZCgSO3RMebcMqOIbGdj3&resource=https%3A%2F%2Fmanagement.azure.com%2F' https://login.microsoftonline.com/[suscripcion]/oauth2/token
```

__Respuesta__
```json
{
    "token_type": "Bearer",
    "expires_in": "3599",
    "ext_expires_in": "3599",
    "expires_on": "1669466828",
    "not_before": "1669462928",
    "resource": "https://management.azure.com/",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzZmYWZiMzc0LThkZjEtNDRkYS05YmM4LTliMTc0ZWRjNjdlYS8iLCJpYXQiOjE2Njk0NjI5MjgsIm5iZiI6MTY2OTQ2MjkyOCwiZXhwIjoxNjY5NDY2ODI4LCJhaW8iOiJFMlpnWUxqcGVXakN5aWJ2aU0rM0pueE8vaXM2Q1FBPSIsImFwcGlkIjoiZDVmODVlNDUtZDQ5Ny00OGQxLWFlZGQtMjJkNTI0ZDAwYzcxIiwiYXBwaWRhY3IiOiIxIiwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvNmZhZmIzNzQtOGRmMS00NGRhLTliYzgtOWIxNzRlZGM2N2VhLyIsImlkdHlwIjoiYXBwIiwib2lkIjoiNTU1MDg5YWMtM2E3Yi00ZjE3LWI1ZWMtZDAzMGFmYjFiYzFiIiwicmgiOiIwLkFYa0FkTE92Yl9HTjJrU2J5SnNYVHR4bjZrWklmM2tBdXRkUHVrUGF3ZmoyTUJONUFBQS4iLCJzdWIiOiI1NTUwODlhYy0zYTdiLTRmMTctYjVlYy1kMDMwYWZiMWJjMWIiLCJ0aWQiOiI2ZmFmYjM3NC04ZGYxLTQ0ZGEtOWJjOC05YjE3NGVkYzY3ZWEiLCJ1dGkiOiJfOTZIaXBWZXZFSzFTWTl0a1JJRUFBIiwidmVyIjoiMS4wIiwieG1zX3RjZHQiOjE2MDM4NjgzNDF9.ot5R-SL_uCAIxnmMD-VbxaHaacLueHPaCwrIXcb95igRPlNs-rouDx8WHlNgDv69RI78TU-fe-oTTx2Su3fjP6DUHao6Bg2P81t_TXqZmG9hhnrA8h4YPDStExRJkOdpp_W94fyyaJ9z4jHJt6hvGOKnVDYqA3myqzhcoAcg4E_Ov1xuby35wWsdjGat0wo1oRVBYQYf9vMQb5KxvTpZG69eow8f5TNDdhS0_j_83_Cfv6mLS3neGAwk0muCCAoYi2Gp-LCi9QottWtI88-vis0IhzsmdynEaIziAM1cIspUmqsUmAWstITPEPIKD1MIuNZvx1XcF1ep_6hF35cWIg"
}
```


__Obtener datos con token__
```bash
~$ curl -X GET -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzZmYWZiMzc0LThkZjEtNDRkYS05YmM4LTliMTc0ZWRjNjdlYS8iLCJpYXQiOjE2Njk0NjI5MjgsIm5iZiI6MTY2OTQ2MjkyOCwiZXhwIjoxNjY5NDY2ODI4LCJhaW8iOiJFMlpnWUxqcGVXakN5aWJ2aU0rM0pueE8vaXM2Q1FBPSIsImFwcGlkIjoiZDVmODVlNDUtZDQ5Ny00OGQxLWFlZGQtMjJkNTI0ZDAwYzcxIiwiYXBwaWRhY3IiOiIxIiwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvNmZhZmIzNzQtOGRmMS00NGRhLTliYzgtOWIxNzRlZGM2N2VhLyIsImlkdHlwIjoiYXBwIiwib2lkIjoiNTU1MDg5YWMtM2E3Yi00ZjE3LWI1ZWMtZDAzMGFmYjFiYzFiIiwicmgiOiIwLkFYa0FkTE92Yl9HTjJrU2J5SnNYVHR4bjZrWklmM2tBdXRkUHVrUGF3ZmoyTUJONUFBQS4iLCJzdWIiOiI1NTUwODlhYy0zYTdiLTRmMTctYjVlYy1kMDMwYWZiMWJjMWIiLCJ0aWQiOiI2ZmFmYjM3NC04ZGYxLTQ0ZGEtOWJjOC05YjE3NGVkYzY3ZWEiLCJ1dGkiOiJfOTZIaXBWZXZFSzFTWTl0a1JJRUFBIiwidmVyIjoiMS4wIiwieG1zX3RjZHQiOjE2MDM4NjgzNDF9.ot5R-SL_uCAIxnmMD-VbxaHaacLueHPaCwrIXcb95igRPlNs-rouDx8WHlNgDv69RI78TU-fe-oTTx2Su3fjP6DUHao6Bg2P81t_TXqZmG9hhnrA8h4YPDStExRJkOdpp_W94fyyaJ9z4jHJt6hvGOKnVDYqA3myqzhcoAcg4E_Ov1xuby35wWsdjGat0wo1oRVBYQYf9vMQb5KxvTpZG69eow8f5TNDdhS0_j_83_Cfv6mLS3neGAwk0muCCAoYi2Gp-LCi9QottWtI88-vis0IhzsmdynEaIziAM1cIspUmqsUmAWstITPEPIKD1MIuNZvx1XcF1ep_6hF35cWIg" -H "Content-Type: application/json" https://management.azure.com/subscriptions/[suscripcion]/providers/Microsoft.Web/sites?api-version=2016-08-01
```

__Respuesta__
~~~json
{
    "value": [
        {
            "id": "/subscriptions/[suscripcion]/resourceGroups/XXX/providers/Microsoft.Web/sites/XXX",
            "name": "XXX",
            "type": "Microsoft.Web/sites",
            "kind": "app,linux",
            "location": "West Europe",
            "tags": {},
            "properties": {
                "name": "XXX",
                "state": "Running",
                "hostNames": [
                    "xxx.azurewebsites.net"
                ],
                "webSpace": "XXX-WestEuropewebspace-Linux",
                "selfLink": "https://waws-prod-am2-609.api.azurewebsites.windows.net:454/subscriptions/[suscripcion]/webspaces/XXX-WestEuropewebspace-Linux/sites/XXX",
                "repositorySiteName": "XXX",
                "owner": null,
                "usageState": "Normal",
                "enabled": true,
                "adminEnabled": true,
                "enabledHostNames": [
                    "xxx.azurewebsites.net",
                    "xxx.scm.azurewebsites.net"
                ],
                "siteProperties": {
                    "metadata": null,
                    "properties": [
                        {
                            "name": "LinuxFxVersion",
                            "value": "NODE|16-lts"
                        },
                        {
                            "name": "WindowsFxVersion",
                            "value": null
                        }
                    ],
                    "appSettings": null
                },
                "availabilityState": "Normal",
                "sslCertificates": [],
                "csrs": [],
                "cers": null,
                "siteMode": "Limited",
                "hostNameSslStates": [
                    {
                        "name": "xxx.azurewebsites.net",
                        "sslState": "Disabled",
                        "ipBasedSslResult": null,
                        "virtualIP": null,
                        "thumbprint": null,
                        "toUpdate": null,
                        "toUpdateIpBasedSsl": null,
                        "ipBasedSslState": "NotConfigured",
                        "hostType": "Standard"
                    },
                    {
                        "name": "xxx.scm.azurewebsites.net",
                        "sslState": "Disabled",
                        "ipBasedSslResult": null,
                        "virtualIP": null,
                        "thumbprint": null,
                        "toUpdate": null,
                        "toUpdateIpBasedSsl": null,
                        "ipBasedSslState": "NotConfigured",
                        "hostType": "Repository"
                    }
                ],
                "computeMode": "Dedicated",
                "serverFarm": null,
                "serverFarmId": "/subscriptions/[suscripcion]/resourceGroups/XXX/providers/Microsoft.Web/serverfarms/ASP-XXX-a463",
                "reserved": true,
                "isXenon": false,
                "hyperV": false,
                "lastModifiedTimeUtc": "2022-09-29T15:20:10.0966667",
                "storageRecoveryDefaultState": "Running",
                "contentAvailabilityState": "Normal",
                "runtimeAvailabilityState": "Normal",
                "secretsCollection": [],
                "vnetRouteAllEnabled": false,
                "containerAllocationSubnet": null,
                "useContainerLocalhostBindings": null,
                "vnetImagePullEnabled": false,
                "vnetContentShareEnabled": false,
                "siteConfig": {
                    "numberOfWorkers": 1,
                    "defaultDocuments": null,
                    "netFrameworkVersion": null,
                    "phpVersion": null,
                    "pythonVersion": null,
                    "nodeVersion": null,
                    "powerShellVersion": null,
                    "linuxFxVersion": "NODE|16-lts",
                    "windowsFxVersion": null,
                    "requestTracingEnabled": null,
                    "remoteDebuggingEnabled": null,
                    "remoteDebuggingVersion": null,
                    "httpLoggingEnabled": null,
                    "azureMonitorLogCategories": null,
                    "acrUseManagedIdentityCreds": false,
                    "acrUserManagedIdentityID": null,
                    "logsDirectorySizeLimit": null,
                    "detailedErrorLoggingEnabled": null,
                    "publishingUsername": null,
                    "publishingPassword": null,
                    "appSettings": null,
                    "metadata": null,
                    "connectionStrings": null,
                    "machineKey": null,
                    "handlerMappings": null,
                    "documentRoot": null,
                    "scmType": null,
                    "use32BitWorkerProcess": null,
                    "webSocketsEnabled": null,
                    "alwaysOn": false,
                    "javaVersion": null,
                    "javaContainer": null,
                    "javaContainerVersion": null,
                    "appCommandLine": null,
                    "managedPipelineMode": null,
                    "virtualApplications": null,
                    "winAuthAdminState": null,
                    "winAuthTenantState": null,
                    "customAppPoolIdentityAdminState": null,
                    "customAppPoolIdentityTenantState": null,
                    "runtimeADUser": null,
                    "runtimeADUserPassword": null,
                    "loadBalancing": null,
                    "routingRules": null,
                    "experiments": null,
                    "limits": null,
                    "autoHealEnabled": null,
                    "autoHealRules": null,
                    "tracingOptions": null,
                    "vnetName": null,
                    "vnetRouteAllEnabled": null,
                    "vnetPrivatePortsCount": null,
                    "publicNetworkAccess": null,
                    "cors": null,
                    "push": null,
                    "apiDefinition": null,
                    "apiManagementConfig": null,
                    "autoSwapSlotName": null,
                    "localMySqlEnabled": null,
                    "managedServiceIdentityId": null,
                    "xManagedServiceIdentityId": null,
                    "keyVaultReferenceIdentity": null,
                    "ipSecurityRestrictions": null,
                    "ipSecurityRestrictionsDefaultAction": null,
                    "scmIpSecurityRestrictions": null,
                    "scmIpSecurityRestrictionsDefaultAction": null,
                    "scmIpSecurityRestrictionsUseMain": null,
                    "http20Enabled": false,
                    "minTlsVersion": null,
                    "minTlsCipherSuite": null,
                    "supportedTlsCipherSuites": null,
                    "scmMinTlsVersion": null,
                    "ftpsState": null,
                    "preWarmedInstanceCount": null,
                    "functionAppScaleLimit": 0,
                    "elasticWebAppScaleLimit": null,
                    "healthCheckPath": null,
                    "fileChangeAuditEnabled": null,
                    "functionsRuntimeScaleMonitoringEnabled": null,
                    "websiteTimeZone": null,
                    "minimumElasticInstanceCount": 0,
                    "azureStorageAccounts": null,
                    "http20ProxyFlag": null,
                    "sitePort": null,
                    "antivirusScanEnabled": null,
                    "storageType": null
                },
                "deploymentId": "XXX",
                "slotName": null,
                "trafficManagerHostNames": null,
                "sku": "Free",
                "scmSiteAlsoStopped": false,
                "targetSwapSlot": null,
                "hostingEnvironment": null,
                "hostingEnvironmentProfile": null,
                "clientAffinityEnabled": false,
                "clientCertEnabled": false,
                "clientCertMode": "Required",
                "clientCertExclusionPaths": null,
                "hostNamesDisabled": false,
                "domainVerificationIdentifiers": null,
                "customDomainVerificationId": "4898D5CEC32ED8DC94248BBD4DC4D899C6C3169B3BAD1CBCC421C103018F0C85",
                "kind": "app,linux",
                "inboundIpAddress": "",
                "possibleInboundIpAddresses": "",
                "outboundIpAddresses": "",
                "possibleOutboundIpAddresses": "",
                "containerSize": 0,
                "dailyMemoryTimeQuota": 0,
                "suspendedTill": null,
                "siteDisabledReason": 0,
                "functionExecutionUnitsCache": null,
                "maxNumberOfWorkers": null,
                "homeStamp": "waws-prod-am2-609",
                "cloningInfo": null,
                "hostingEnvironmentId": null,
                "tags": {},
                "resourceGroup": "XXX",
                "defaultHostName": "xxx.azurewebsites.net",
                "slotSwapStatus": null,
                "httpsOnly": true,
                "redundancyMode": "None",
                "inProgressOperationId": null,
                "geoDistributions": null,
                "privateEndpointConnections": null,
                "publicNetworkAccess": null,
                "buildVersion": null,
                "targetBuildVersion": null,
                "migrationState": null,
                "eligibleLogCategories": "AppServiceAppLogs,AppServiceAuditLogs,AppServiceConsoleLogs,AppServiceHTTPLogs,AppServiceIPSecAuditLogs,AppServicePlatformLogs,ScanLogs",
                "storageAccountRequired": false,
                "virtualNetworkSubnetId": null,
                "keyVaultReferenceIdentity": "SystemAssigned",
                "privateLinkIdentifiers": null
            }
        }
    ],
    "nextLink": null,
    "id": null
}
~~~




Referencias:  

[AZ cli crear service principal](https://learn.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest#az-ad-sp-create-for-rbac)  
[Calling Azure REST API via curl](https://mauridb.medium.com/calling-azure-rest-api-via-curl-eb10a06127)  
[How to authenticate in Azure REST API with Postman](https://abcdazure.azurewebsites.net/how-to-authenticate-in-azure-rest-api/)
[Diferencias form-dat, x-www-form-urlencode y raw](https://stackoverflow.com/questions/26723467/postman-chrome-what-is-the-difference-between-form-data-x-www-form-urlencoded)  
[Azure Rest APi Postman](https://blog.jongallant.com/2021/02/azure-rest-apis-postman-2021/)  
[Azure REST API reference](https://learn.microsoft.com/es-es/rest/api/azure/#components-of-a-rest-api-requestresponse)  
